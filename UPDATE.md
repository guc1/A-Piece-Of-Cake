# Update Log

- 2025-08-16: Initial bootstrap with Next.js, Tailwind, shadcn/ui components, guest authentication, Drizzle setup, and Playwright smoke test scaffold.
- 2025-08-16: Added Cake dashboard with radial slice navigation and color tokens.
- 2025-08-16: Fixed authentication helper and added API route for NextAuth.

- 2025-08-17: Replaced auth wrapper with NextAuth factory to fix runtime error.
- 2025-08-17: Switched to getServerSession helper and direct NextAuth route handler to resolve "auth is not a function" error.

## Follow-ups

- [ ] Add OAuth (Google) + DB adapter for NextAuth
- [ ] Implement onboarding for Signature Ethos + Credo
- [ ] Wire flavors UI to DB
- [ ] Add visibility model and guards
- [ ] Add AI coach stub endpoint/action
- 2025-08-18: Added CSS-based 3D cake with animated wedges linked to navigation boxes.
- 2025-08-18: Centered cake layout, added in-slice labels and direct slice navigation with stable IDs.
- 2025-08-18: Repositioned cake higher with responsive offset and optical left nudge; navigation boxes remain centered.
- 2025-08-19: Made navigation boxes compact and added hover-only slice labels driven by separate hoveredSlug state.
- 2025-08-20: Lowered cake for arced title, removed slice labels, added hoveredSlug-driven box pop with reduced-motion support, and rendered responsive "A Piece Of Cake" title arc.
- 2025-08-21: Replaced arc title with centered H1 and reshaped cake into six equal circular slices with seam gaps.
- 2025-08-22: Raised navigation boxes, synced slice hover with box animations, and simplified labels.
- 2025-08-22: Added flavors MVP with sortable list, creation/edit drawer, and API routes.
- 2025-08-23: Replaced flavor drawer with centered modal, added server actions for create/update, autosizing description field, and updated tests.
- 2025-08-24: Persisted user id in NextAuth session to fix "Please sign in" error when saving flavors.
- 2025-08-24: Prevented modal from refocusing on the name field while typing flavor descriptions.
- 2025-08-25: Added email/password authentication with sign-up and login pages and stored flavors in Postgres.
- 2025-08-25: Added migration to add slug to flavors and guarded user ID parsing to prevent NaN queries.
- 2025-08-26: Added subflavors with CRUD UI, server actions, API routes, and navigation button from flavors list.
- 2025-08-26: Added settings button with sign-out, dark mode toggle, follower count display, and profile visibility toggle.
- 2025-08-27: Introduced social "People" pages with follow system, inbox for requests, and profile visibility enforcement.
- 2025-08-27: Fixed sign-up flow to require unique handle, enabling multiple user accounts; updated Playwright tests and added people listing test.
- 2025-08-27: Added account visibility API and settings control; only open accounts are visible in People page.
- 2025-08-27: Validated follower existence in follow action to prevent foreign key errors.
- 2025-08-27: Auto-created missing user records during follow to avoid "User not found" errors.
- 2025-08-27: Reconciled session users with DB via email, preventing duplicate records and hiding self on People page.
- 2025-08-28: Enabled class-based dark mode toggle, added account visibility API route, and sent inbox notifications for auto-accepted follows.
- 2025-08-30: Added followers API, updated settings menu with live follower count, dark mode toggle fix, and link to new account settings page for visibility changes.
- 2025-08-30: Fixed follow visibility and notifications; renamed People page section to "Following" so followed users remain discoverable.
- 2025-08-30: Kept closed-account follows visible, added unfollow notifications, and surfaced them in the inbox.
- 2025-08-30: Enabled follow-back after accepting requests, added decline notifications, and ensured closed accounts appear in Discover.
- 2025-08-30: Fixed profile route params handling and ensured inbox shows follow requests/notifications for all users.
- 2025-08-31: Added profile overview and read-only View Account pages with visibility rules, introduced viewId and view context utilities, and updated People follow states.
- 2025-08-31: Refined View Account to land on Cake home, added viewer bar with Exit, dynamic view routing, and navigation helper.
- 2025-08-31: Added userId query parameter to owner routes and redirect to own account, switching to viewId when viewing others.
- 2025-09-01: Ensured flavor actions create missing user records to avoid foreign key errors when inserting flavors.
- 2025-09-01: Fixed view context to default to the current user, added viewer check helper, and awaited People page search params to silence runtime warnings.
- 2025-09-02: Bound owner vs viewer mode to route prefix, added auth-based assertOwner helper, removed uid query params, and scoped People and navigation reads by ownerId.
- 2025-09-03: Added hrefFor navigation helper so view mode persists across routes and logged viewer bar presence.
- 2025-09-03: Split owner and viewer layouts with context-based routing, migrated view routes to their own group, and refined viewer bar exit behavior.
- 2025-09-24: Blocked People tab for profile viewers and fixed edit mode detection after exiting view.
- 2025-09-24: Disabled save and delete buttons in viewing mode to prevent accidental edits.
- 2025-09-24: Awaited subflavor route params and added view-mode subflavor path so profile viewers can browse without editing.
- 2025-09-25: Added Planning landing with mode buttons and next-day planner editor with draggable time blocks, metadata panel, persistence, and read-only viewer mode.
- 2025-09-25: Enabled block edge resizing with 15-minute snap, kept next-day planner open on save, and tightened timeline to show all hours with side labels.
- 2025-09-26: Improved next-day planner with cursor feedback near block edges, persistent metadata panel on click, and hourly time column from 00:00 to 24:00.
- 2025-09-27: Aligned planner metadata times with timeline, added block deletion, and enabled cross-day navigation by dragging beyond timeline bounds.
- 2025-09-27: Prevented planner glitches by clamping blocks to 23:59 and restricting cross-day jumps to block moves.
- 2025-09-27: Awaited planner search params to remove runtime warnings when loading the next-day page.
- 2025-09-27: Dropped dragging when the cursor leaves the timeline, preventing disappearing planner blocks.
- 2025-09-27: Enabled viewing next-day planning in read-only mode via view routes and added test coverage.
- 2025-09-27: Ensured nested planning blocks render above their containers and added regression test.
- 2025-09-27: Removed planning metadata save button and enabled automatic persistence on edit with updated tests.
- 2025-09-27: Added adjustable planner range with default 05:00â€“22:00 view, earlier/later loading, and custom time inputs to resize the timeline.
- 2025-09-27: Placed new timeslots within custom range, falling back to 30-minute or random 1-hour blocks when space is limited.
- 2025-09-28: Introduced live planning view with real-time indicator, automatic block metadata selection, and viewer support.
- 2025-09-28: Stored live planning adjustments locally without altering next-day plans.
- 2025-09-29: Added hidden TimeMachine overlay triggered by clicking the "c" in "Piece" five times to override site date/time for testing.
- 2025-09-29: Added reset-to-current-time option (Dutch timezone) and auto-close behavior when applying overrides.
- 2025-09-30: Added slide-out calendar panel on home screen with past 30 days and upcoming week view.
- 2025-09-30: Enabled month navigation in slide-out calendar to jump one month backward or forward.
- 2025-08-18: Implemented profile snapshot system with historical viewing mode and calendar access.
- 2025-08-18: Implemented profile snapshot system with historical viewing mode and calendar access.
- 2025-10-01: Added visual historical profile pages with snapshot-based flavors and subflavors navigation.
- 2025-08-19: Added ingredients feature with CRUD UI, server actions, history revisions, and viewer copying.
- 2025-10-02: Added review planning view with per-block good/bad feedback and general day vibe modal.
- 2025-10-02: Relocated general day vibe action to planner toolbar, removed add timeslot in review, and ensured modal blurs background.
- 2025-10-02: Highlighted general day vibe button and raised vibe modal above planner blocks.
- 2025-10-03: Restricted new planning blocks to selected time range and ensured timeline hour labels are fully visible.
- 2025-10-05: Separated next-day and live planning dates so next-day always targets tomorrow while live and review load today's plan.
- 2025-10-05: Auto-reload planning pages when system date changes to keep next-day and live planning in sync.
- 2025-10-06: Persisted TimeMachine overrides across navigation and displayed current date/time in header for debugging.
- 2025-10-06: Synced TimeMachine offset with server via cookie, removed nested HTML wrappers to fix hydration loops.
- 2025-10-07: Normalized server time via cookie-aware helper and forced consistent clock formatting to stop planner reload flicker.
- 2025-10-07: Fixed clock hydration mismatch and corrected server time helper so next-day plans no longer leak into today's live view.
- 2025-10-07: On day rollover, automatically promote yesterday's "next-day" plan to today's live plan and clear the next-day slate.
- 2025-10-07: Removed rollover logic so next-day plans remain separate from today's live plan until the date actually changes.
- 2025-10-08: Implemented timezone-safe planning with canonical clock, manual override, and date-resolved plan loading.
- 2025-10-09: Fixed day arithmetic to keep "next" and "live" planning dates stable across timezones.
- 2025-10-09: Awaited planning search params to satisfy Next.js dynamic API requirements.
- 2025-10-09: Added historical planning route to view past plans in read-only mode with Playwright test.
- 2025-10-09: Added self historical planning route so owners can review their past plans.
- 2025-10-10: Expanded historical planning with landing screen and live/next/review pages for full time-capsule viewing.
- 2025-10-10: Removed live indicator from historical planning and allowed all past reviews to open without time gating.
- 2025-10-11: Fixed profile snapshot date offset by respecting user timezone and displaying correct days in calendar.
- 2025-10-11: Corrected ingredient owner validation, awaited search params to silence warnings, and swapped image URL input for preset choices.
- 2025-10-11: Simplified ingredient image selector to highlight the chosen preset without large preview.
- 2025-10-12: Added ingredient import flow with preset choices and social search.
- 2025-10-12: Fixed preset import tags and ensured viewers have user records when copying ingredients.
- 2025-10-13: Added search filtering for flavors and subflavors.
- 2025-10-14: Added flavor and subflavor import flows with presets, social search, and copy options.
- 2025-10-15: Added aggregated subflavors viewer listing all subflavors by flavor importance and linked search to it.
- 2025-10-16: Prompted flavor selection when copying subflavors and allowed promoting subflavor to main flavor.
- 2025-10-17: Enabled copying flavors from historical snapshots for owners and viewers and added tests.
- 2025-10-17: Enabled copying subflavors from historical snapshots for owners and viewers and added tests.
- 2025-10-17: Added destination picker when copying subflavors from viewer and historical pages.
- 2025-10-17: Introduced generic IconPicker with custom uploads, presets, and social options; integrated into flavor and subflavor forms.
- 2025-10-17: Enlarged IconPicker modal and fixed rendering of uploaded icons.
- 2025-10-17: Enhanced uploaded icon quality and ensured icons fill circular frames edge-to-edge.
- 2025-10-17: Widened flavor and subflavor icon columns to text so custom images migrate without length errors.
- 2025-10-17: Added Other People Icons tab with user search and icon import into My Icons.
- 2025-10-17: Fixed empty icon src errors, awaited user icon route params, and expanded Other People Icons view for larger user lists.

- 2025-10-17: Persisted My Icons server-side and exposed all user icons, including private ones, when browsing profiles.

- 2025-10-17: Added icon picker and storage for ingredients.
- 2025-10-17: Shrunk ingredient icons and ensured images fill their circular frames.
- 2025-10-17: Saved preset icon selections to My Icons and added a close button to the icon picker.
- 2025-10-17: Deduplicated saved icons, removed oversized My Icons unique index, and fixed duplicate-key warnings so icon uploads persist reliably.
- 2025-10-17: Ensured My Icons saving auto-creates missing user records to prevent foreign key errors and keep icons persistent.
- 2025-10-17: Snapshots capture user icon libraries and prompt before importing historical icons into My Icons.
- 2025-10-17: Made My Icons API snapshot-aware and allowed copying historical icons without altering past snapshots.
- 2025-10-17: Fixed My Icons snapshot views to show historical icons only and block edits while allowing copying to the current library.
- 2025-10-17: Clicking snapshot icons now opens the owner's full historical icon library with copy prompts.
- 2025-10-18: Added split review page with rational and guilty pleasure sections and placeholder for AI panel.
- 2025-10-18: Enlarged review text areas, added independent scrolling, and captured review page snapshots with viewer read-only mode.
- 2025-10-18: Expanded review boxes so guilty pleasure starts below the fold and enforced separate scrollbars for review and AI panes with tests.
- 2025-10-18: Added future planning date navigation with snapshots preserving historical plans.
- 2025-08-20: Resolved duplicate plan block IDs for future planning and embedded date navigation controls beside planner toolbar actions.
- 2025-08-20: Blocked selecting dates earlier than tomorrow in next-day planner and fixed single-day advance navigation.
- 2025-08-20: Corrected next-day planner navigation to parse dates in the user's timezone, redirect past selections, and advance week jumps by seven days.
- 2025-08-20: Added reverse and reset controls to future planning date navigation and prevented navigation before upcoming planning date.
- 2025-10-19: Cached future planning edits in local storage and added cross-day persistence test.
- 2025-10-20: Fixed historical plans showing future edits by ignoring revisions saved after snapshots and added test.
- 2025-10-20: Synced planner state on client-side navigation and fetched historical plans at snapshot time to show exact past versions without refresh.
- 2025-10-21: Documented missing ID patterns for planning, flavors, subflavors, people lists, and history pages.
- 2025-10-21: Completed ID catalog with cake and people sections and pruned unused identifiers.
- 2025-10-21: Added ingredient selection to planning blocks with snapshot support and read-only viewer mode.
- 2025-10-22: Introduced dedicated ingredient picker and detail pages for planning, improved icon rendering, and fixed snapshot ingredient errors.
- 2025-10-22: Enabled previewing ingredients before attaching and ensured ingredient additions persist for live and next planning.
- 2025-10-23: Softened add-ingredient pill, added back buttons to picker and detail pages, and allowed viewers to open ingredient details without 404s.
- 2025-10-23: Display "No ingredient found" placeholders and label hidden ingredients as "Secret ðŸ”’".
- 2025-10-24: Introduced Daily Aim modal with daily ingredients on planning pages and saved values in plan snapshots.
- 2025-10-24: Ensured Daily Aim is stored per day, remounting planners on date changes and
  highlighting the Daily Aim button red when empty and green when filled.
- 2025-10-24: Enlarged Daily Aim editor with top-left close and Done buttons, prevented accidental closing during text selection, and kept toolbar color green when filled.
- 2025-10-24: Further expanded Daily Aim modal for more editing space and turned toolbar green when text or daily ingredients are present.
- 2025-10-24: Fixed Daily Aim button colors to show red when empty and green when filled, and greatly enlarged modal editor with a top-left close button.
- 2025-10-24: Widened Daily Aim modal and restored red/green button colors when empty vs filled.
- 2025-10-24: Halved Daily Aim modal width, added generous padding, and fixed green state when content present.
- 2025-10-24: Kept Daily Aim modal open after adding ingredients, centered title text, and added spacing to ingredient list.
- 2025-10-24: Increased Daily Aim ingredient list padding and turned Daily Aim button green when text or ingredients present.
- 2025-10-24: Added matching padding to Daily ingredients heading and add button, and kept Daily Aim button green after edits.
- 2025-10-24: Colored Daily Aim button red when empty and green when any text or ingredients are added.
- 2025-10-24: Exposed activity ingredients in review mode and let users write per-ingredient feedback.
- 2025-10-24: Moved ingredient list and feedback button below good/bad review fields.
- 2025-10-24: Placed ingredient feedback boxes above the ingredient list in review mode.
- 2025-10-24: Added review-only Daily Aim modal with feedback fields and per-ingredient reviews; renamed button to "Review daily aim" and kept it red when empty.
